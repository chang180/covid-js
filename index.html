<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="covid19">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="張建文">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>covid19</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.21/datatables.min.css" />

    <script src="jquery-3.5.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.21/datatables.min.js"></script>
</head>

<body>
    <h1 class="text-center">臺灣Covid-19趨勢圖(第17週起)</h1>
    <canvas id="Chart" height="80" width="400">123</canvas>
    <h1 class="text-center">永和地區Covid-19趨勢圖(第17週起)</h1>
    <canvas id="myChart" height="80" width="400">123</canvas>
</body>
<!-- <footer>
    <h3 class="text-center">Covid-19</h3>
    <div class="text-center"><a href="">Covid-19</a></div>
</footer> -->
<script>
    // $.getJSON("covid.json", e => {
    $.getJSON("./curlget.php", e => {
        let data = e
            // console.log(data)
        var dataTotal = data.length; //資料長度
        var obj = {} //新物件
        var all = {} //全國性資料
        for (var i = 0; i < dataTotal; i++) {
            if (all[data[i]['發病週別']]) {
                all[data[i]['發病週別']].value = Number(all[data[i]['發病週別']].value) + Number(data[i]['確定病例數']);
            } else {
                all[data[i]['發病週別']] = {
                    value: Number(data[i]['確定病例數'])
                }
            }
            if (data[i]['縣市'] == "新北市" && data[i]['鄉鎮'] == "永和區") {
                // console.log("區域:" + data[i]['縣市'] + " 鄉鎮:" + data[i]['鄉鎮'] + " 發病週別:" + data[i]['發病週別'] + " 確定病例數:" + data[i]['確定病例數']);
                // for (var i in data) {
                if (obj[data[i]['發病週別']]) {
                    obj[data[i]['發病週別']].value = Number(obj[data[i]['發病週別']].value) + Number(data[i]['確定病例數']);
                } else {
                    obj[data[i]['發病週別']] = {
                        value: Number(data[i]['確定病例數'])
                    }
                }
                // }
            }
        }
        console.log(all)

        var label = []
        var number = []
            // obj.forEach(element => {
            //     // label.push(key)
            //     // number.push(element.value)
            //     console.log(element)
            // });
        for (var i in all) {
            label.push(i)
            number.push(all[i].value)
        }
        label = label.slice(10)
        number = number.slice(10)
            // console.log(label)
            // console.log(number)
        var ctx = document.getElementById('Chart');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: label,
                datasets: [{
                    label: '臺灣疫情趨勢圖',
                    data: number,
                    backgroundColor: 'green',
                    borderColor: 'darkblue',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false
                        }
                    }]
                }
            }
        });

        label = []
        number = []

        for (var i in obj) {
            label.push(i)
            number.push(obj[i].value)
        }
        var ctx = document.getElementById('myChart');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: label,
                datasets: [{
                    label: '永和地區疫情趨勢圖',
                    data: number,
                    backgroundColor: 'darkblue',
                    borderColor: 'green',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false
                        }
                    }]
                }
            }
        });
    })
</script>

</html>